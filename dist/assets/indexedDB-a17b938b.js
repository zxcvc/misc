import"./modulepreload-polyfill-3cfb730f.js";function m(n,e){const t=window.indexedDB.open(n,e);return new Promise((r,o)=>{t.addEventListener("success",s=>{r(s.target.result)}),t.addEventListener("error",s=>{o(s)}),t.addEventListener("upgradeneeded",s=>{console.log(2);const c=s.target.result.createObjectStore(n,{keyPath:"id",autoIncrement:!1});c.createIndex("name","name",{unique:!1}),c.createIndex("age","age",{unique:!1})})})}function d(n,...e){return n.transaction(...e)}function i(n,e){return n.objectStore(e)}function v(n,e){e.forEach(t=>{n.add(t)})}function E(n,e){e.forEach(t=>{const r=Object.keys(t)[0];n.index(r).openCursor(IDBKeyRange.only(t[r])).addEventListener("success",a=>{const c=a.target.result;c&&(c.delete(),c.continue())})})}function L(n,e){const t=Object.keys(e)[0];n.index(t).openCursor(IDBKeyRange.only(e[t])).addEventListener("success",o=>{const s=o.target.result;if(s){const a=s.value;s.update({...a,...e})}})}function y(n,e){const t=Object.keys(e)[0],o=n.index(t).getAll(IDBKeyRange.only(e[t]));return new Promise((s,a)=>{o.addEventListener("success",c=>{const g=c.target.result;s(g)}),o.addEventListener("error",c=>{a(c)})})}const _="user";let f=1;const{0:p,1:b,2:q,3:k}=document.querySelectorAll("button:not(#submit)"),w=document.querySelector("#name"),x=document.querySelector("#age");function u(){const n=w.value,e=x.value,t={};return n!==""&&(t.name=n),e!==""&&(t.age=Number(e)),t}const l=await m(_,f);p.addEventListener("click",n=>{const e=d(l,["user"],"readwrite");e.addEventListener("complete",o=>{console.log("事务完成",o)}),e.addEventListener("error",o=>{console.log("事务失败",o)});const t=i(e,"user"),r=u();r.id=Math.random(),v(t,[r])});b.addEventListener("click",n=>{const e=d(l,["user"],"readwrite");e.addEventListener("complete",o=>{console.log("事务完成",o)}),e.addEventListener("error",o=>{console.log("事务失败",o)});const t=i(e,"user"),r=u();E(t,[r])});q.addEventListener("click",n=>{const e=d(l,["user"],"readwrite");e.addEventListener("complete",o=>{console.log("事务完成",o)}),e.addEventListener("error",o=>{console.log("事务失败",o)});const t=i(e,"user"),r=u();L(t,r)});k.addEventListener("click",async n=>{const e=d(l,["user"],"readwrite");e.addEventListener("complete",s=>{console.log("事务完成",s)}),e.addEventListener("error",s=>{console.log("事务失败",s)});const t=i(e,"user"),r=u(),o=await y(t,r);console.log(o)});
